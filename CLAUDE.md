# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Development
- `npm run dev:win` - Start development server (Windows PowerShell)
- `npm run dev` - Start development server (Linux/Mac)
- `npm run build:win` - Production build (Windows PowerShell)
- `npm run build` - Production build (Linux/Mac)
- `npm run check` - TypeScript type checking

### Database
- `npm run db:push` - Push schema changes to database
- `npm run db:studio` - Open Drizzle Studio database editor
- `npm run db:generate` - Generate migration files
- `npm run db:migrate` - Run database migrations

### Testing & Setup
- `npm run test:keys` - Test API key configuration
- `npm run test:db` - Test database connection
- `npm run setup:auth` - Authentication setup assistant


## Architecture

### Tech Stack
- **Frontend**: React 18 + TypeScript, Vite build system, Tailwind CSS + Radix UI components
- **Backend**: Node.js + Express + TypeScript, real-time WebSocket support
- **Database**: PostgreSQL with Drizzle ORM, Row Level Security via Supabase
- **AI Services**: Anthropic Claude 3.5 Sonnet (primary), OpenAI GPT-4o, Perplexity AI for research
- **Voice**: ElevenLabs text-to-speech integration

### Project Structure
- `client/` - React frontend application
- `server/` - Express backend with AI service integrations
- `shared/schema.ts` - Drizzle database schema and type definitions
- `scripts/` - Database migration and setup utilities

### Database Schema
The application uses a comprehensive medical data model with 12 tables:
- **Core**: users, medical_history, symptom_sets, symptom_entries, differential_diagnoses, prescriptions, notifications
- **Chat**: chat_conversations, chat_messages for real-time AI interactions
- **Voice**: voice_conversations, voice_transcripts, voice_words for detailed voice analytics

### AI Integration Pattern
The system supports multi-AI analysis with a comparison mode:
- AI services are abstracted through service classes (`ai-service.ts`, `anthropic-service.ts`, `openai-service.ts`)
- Differential diagnoses are generated by multiple AI providers with confidence scoring
- Real-time streaming responses supported via WebSocket for chat interfaces

### Authentication & Security
- Supabase authentication with automatic session management
- Environment-based API key configuration (never commit secrets)
- Row Level Security enforced at database level
- HIPAA-compliant data handling patterns

### Voice System
- Hybrid transcription system supporting real-time and batch processing
- Word-level timestamps and medical term detection
- ElevenLabs integration for accessibility features
- Detailed analytics with speaker diarization support

### Frontend Architecture
- React Query for state management and API caching
- Wouter for client-side routing
- Mobile-first responsive design with specialized mobile components
- Real-time updates via WebSocket connections

### Environment Configuration
Critical API keys must be configured in `.env.local`:
- `ANTHROPIC_API_KEY` - Primary AI service
- `OPENAI_API_KEY` - Secondary AI service  
- `PERPLEXITY_API_KEY` - Research citations
- `ELEVENLABS_API_KEY` - Voice synthesis
- `DATABASE_URL` - PostgreSQL connection string

Run `npm run test:keys` to validate configuration before development.